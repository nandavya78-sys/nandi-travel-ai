<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Nandi Travel AI</title>

<style>
body {
  margin: 0;
  background: #0b1220;
  font-family: system-ui;
  color: #e5e7eb;
}

.header {
  padding: 14px;
  text-align: center;
  font-size: 20px;
  background: #020617;
}

.chat {
  padding: 16px;
  height: calc(100vh - 170px);
  overflow-y: auto;
}

.msg {
  max-width: 75%;
  margin-bottom: 12px;
  padding: 10px 14px;
  border-radius: 10px;
}

.bot { background: #1e293b; }
.user { background: #2563eb; margin-left: auto; }

.input-bar {
  display: flex;
  gap: 8px;
  padding: 10px;
  background: #020617;
}

input, select, button {
  padding: 8px;
  border-radius: 6px;
  border: none;
}

input { flex: 1; }

button {
  background: #2563eb;
  color: white;
  cursor: pointer;
}

.mode-panel {
  display: none;
  background: #020617;
  padding: 10px;
  gap: 6px;
}

.card {
  background: #020617;
  padding: 10px;
  border-radius: 8px;
  margin-top: 6px;
}

@media (max-width: 600px) {
  .msg { max-width: 90%; }
}
</style>
</head>

<body>

<div class="header">‚úàÔ∏è Nandi Travel AI</div>

<div class="chat" id="chat">
  <div class="msg bot">Hi there! How can I help you today?</div>
</div>

<!-- MODE PANEL -->
<div class="mode-panel" id="modePanel">
  <button onclick="startFlights()">Flights</button>
  <button onclick="startHotels()">Hotels</button>
</div>

<div class="input-bar">
  <button onclick="togglePanel()">+</button>
  <input id="text" placeholder="Type a message‚Ä¶" />
  <button onclick="send()">Send</button>
</div>

<script>
let mode = null;

const chat = document.getElementById("chat");
const text = document.getElementById("text");

function addMsg(html, cls="bot") {
  const d = document.createElement("div");
  d.className = "msg " + cls;
  d.innerHTML = html;
  chat.appendChild(d);
  chat.scrollTop = chat.scrollHeight;
}

function togglePanel() {
  const p = document.getElementById("modePanel");
  p.style.display = p.style.display === "flex" ? "none" : "flex";
}

function send() {
  if (!text.value) return;
  addMsg(text.value, "user");
  fetch("/chat", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ message: text.value })
  })
  .then(r=>r.json())
  .then(d=>addMsg(d.reply));
  text.value="";
}

/* ENTER KEY FIX */
text.addEventListener("keydown", e => {
  if (e.key === "Enter") send();
});

/* ---------- FLIGHTS FLOW ---------- */
function startFlights() {
  mode = "flight";
  addMsg(`
    ‚úàÔ∏è <b>Flight search</b><br><br>
    From: <input id="fFrom"><br><br>
    To: <input id="fTo"><br><br>
    Depart: <input type="date" id="fDepart"><br><br>
    Return: <input type="date" id="fReturn"><br><br>
    Stops:
    <select id="fStops">
      <option>Any</option>
      <option>Non-stop</option>
      <option>1 Stop</option>
    </select><br><br>
    <button onclick="searchFlights()">Search Flights</button>
  `);
}

/* ---------- HOTELS FLOW ---------- */
function startHotels() {
  mode = "hotel";
  addMsg(`
    üè® <b>Hotel search</b><br><br>
    City: <input id="hCity"><br><br>
    Check-in: <input type="date" id="hIn"><br><br>
    Check-out: <input type="date" id="hOut"><br><br>
    Stars:
    <select id="hStars">
      <option>Any</option>
      <option>3</option>
      <option>4</option>
      <option>5</option>
    </select><br><br>
    <button onclick="searchHotels()">Search Hotels</button>
  `);
}

/* ---------- RESULTS ---------- */
function searchFlights() {
  fetch("/flight",{method:"POST"})
  .then(r=>r.json())
  .then(d=>{
    d.forEach(f=>{
      addMsg(`
        <div class="card">
          ‚úàÔ∏è <b>${f.airline}</b><br>
          ${f.route}<br>
          ${f.stops}<br>
          <b>${f.price}</b>
        </div>
      `);
    });
  });
}

function searchHotels() {
  fetch("/hotel",{method:"POST"})
  .then(r=>r.json())
  .then(d=>{
    d.forEach(h=>{
      addMsg(`
        <div class="card">
          üè® <b>${h.name}</b><br>
          ‚≠ê ${h.stars}<br>
          <b>${h.price}</b>
        </div>
      `);
    });
  });
}
</script>

</body>
</html>
